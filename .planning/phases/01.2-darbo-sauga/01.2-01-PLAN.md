---
phase: 01.2-darbo-sauga
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [scripts/ingest-dss-istatymas.ts, src/types/index.ts, src/lib/pinecone/index.ts]
autonomous: true
---

<objective>
Ingest DSS Įstatymas (Occupational Safety Act) as legislation source.

Purpose: Add foundational occupational safety law to enable safety Q&A with article citations.
Output: DSS Įstatymas articles embedded in Pinecone with docType=legislation, lawCode=DSS.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01.2-darbo-sauga/PRD.md

# Existing patterns to follow:
@scripts/ingest-vdi-docs.ts
@src/lib/pinecone/index.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DSS Įstatymas ingestion script</name>
  <files>scripts/ingest-dss-istatymas.ts</files>
  <action>
Create ingestion script for DSS Įstatymas from e-tar.lt.

Source URL: https://www.e-tar.lt/portal/lt/legalAct/TAR.E400C8BB686C/asr

Follow existing ingest-vdi-docs.ts patterns:
- Lazy-init Pinecone and GenAI clients
- Support --dry-run flag
- Use cheerio for HTML parsing

Script structure:
1. Fetch consolidated version HTML from e-tar.lt
2. Parse article structure (straipsniai) - look for article numbers and titles
3. For each article:
   - Extract article number, title, and full text
   - Generate embedding via text-embedding-004
   - Create vector with metadata:
     ```
     id: `dss-istatymas-str-{articleNumber}`
     metadata: {
       docId: `dss-str-{articleNumber}`,
       docType: 'legislation',
       lawCode: 'DSS',
       articleNumber: number,
       articleTitle: string,
       text: string (truncated to 8000 chars),
       sourceUrl: 'https://www.e-tar.lt/portal/lt/legalAct/TAR.E400C8BB686C/asr'
     }
     ```
4. Upsert to Pinecone in batches of 100
5. Print summary with article count

Rate limiting: 100ms delay every 5 embeddings, 500ms between fetches.

Note: DSS Įstatymas has ~50 articles. No chunking needed - embed each article as single vector (similar to Darbo Kodeksas pattern).
  </action>
  <verify>npx tsx scripts/ingest-dss-istatymas.ts --dry-run shows articles parsed</verify>
  <done>Script parses DSS articles with correct metadata structure</done>
</task>

<task type="auto">
  <name>Task 2: Add lawCode to SearchResult metadata</name>
  <files>src/lib/pinecone/index.ts, src/types/index.ts</files>
  <action>
Add lawCode field to support distinguishing DSS from Darbo Kodeksas:

In src/types/index.ts ChunkMetadata interface:
- Add `lawCode?: string;` field

In src/lib/pinecone/index.ts SearchResult interface:
- Add `lawCode?: string;` to metadata type
- Add lawCode mapping in mapResult function

This enables citation formatting like "DSS įstatymo 12 str." vs "DK 57 str."
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit</verify>
  <done>lawCode field available in search results metadata</done>
</task>

<task type="auto">
  <name>Task 3: Run DSS ingestion</name>
  <files>scripts/ingest-dss-istatymas.ts</files>
  <action>
Run the ingestion script to populate Pinecone:

```bash
npx tsx scripts/ingest-dss-istatymas.ts
```

Expected output:
- ~50 articles ingested
- Each article has docType=legislation, lawCode=DSS
- No errors during embedding or upsert

If any articles fail to parse, log warning and continue.
  </action>
  <verify>Script completes without errors, reports total vectors upserted</verify>
  <done>DSS Įstatymas articles in Pinecone with lawCode=DSS</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] Dry run shows article parsing works
- [ ] Full run completes without errors
- [ ] Pinecone contains DSS vectors (verify count in logs)
</verification>

<success_criteria>
- All tasks completed
- DSS Įstatymas articles embedded in Pinecone
- lawCode field available for citation formatting
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/01.2-darbo-sauga/01.2-01-SUMMARY.md`
</output>
