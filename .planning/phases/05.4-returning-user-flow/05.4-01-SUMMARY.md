---
phase: 05.4-returning-user-flow
plan: 01
subsystem: ui
tags: [react, firestore, onboarding, ux]

# Dependency graph
requires:
  - phase: 05-auth-billing
    provides: User profile storage in Firestore
provides:
  - Returning user detection on homepage
  - Auto-skip to step 3 for users with saved profiles
  - Step indicator showing selected values
  - Immediate Firestore persistence for profile changes
affects: [chat, account]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Profile-aware onboarding flow"
    - "Lazy profile loading with auth dependency"

key-files:
  created: []
  modified:
    - src/app/page.tsx

key-decisions:
  - "Check Firestore only (not localStorage) for returning user detection"
  - "Always clear topic for returning users - let them pick fresh each time"

patterns-established:
  - "Show loading state while auth settles + profile loads"
  - "Use merge: true for partial profile updates"

# Metrics
duration: 2min
completed: 2026-01-27
---

# Phase 5.4 Plan 01: Returning User Flow Summary

**Returning users with saved profiles skip to topic selection, with clickable step indicator showing their previous selections**

## Performance

- **Duration:** 2 min
- **Started:** 2026-01-27T15:22:08Z
- **Completed:** 2026-01-27T15:23:51Z
- **Tasks:** 3
- **Files modified:** 1

## Accomplishments
- Returning users (authenticated with Firestore profile) land directly on step 3
- Step indicator displays selected role/company labels with hover-to-edit affordance
- Profile changes persist to Firestore immediately when re-selecting role or company size
- New users continue to see full 3-step flow unchanged

## Task Commits

Each task was committed atomically:

1. **Task 1: Detect saved profile and auto-advance to step 3** - `fc56395` (feat)
2. **Task 2: Enhance step indicator with selected values** - `b3792c1` (feat)
3. **Task 3: Update Firestore when user changes saved values** - `a77d958` (feat)

## Files Created/Modified
- `src/app/page.tsx` - Added profile loading, step indicator labels, immediate persistence

## Decisions Made
- Check Firestore only for returning user detection (localStorage is for immediate redirect, not profile persistence)
- Topic is always cleared for returning users - they pick a fresh topic each session

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness
- Returning user flow complete
- Phase 5.4 complete (single plan phase)

---
*Phase: 05.4-returning-user-flow*
*Completed: 2026-01-27*
