---
phase: 08-consultation-saving
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/sidebar.tsx
  - src/components/ui/sheet.tsx
  - src/components/ui/tooltip.tsx
  - src/components/chat/ChatSidebar.tsx
  - src/components/chat/ConsultationList.tsx
  - src/app/chat/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar is visible on chat page (collapsible)"
    - "Sidebar shows list of past consultations"
    - "Sidebar converts to sheet on mobile"
    - "Sidebar toggle works with keyboard shortcut (Cmd+B)"
  artifacts:
    - path: "src/components/ui/sidebar.tsx"
      provides: "shadcn/ui Sidebar primitives"
      exports: ["Sidebar", "SidebarProvider", "SidebarContent", "SidebarTrigger"]
    - path: "src/components/chat/ChatSidebar.tsx"
      provides: "Main sidebar component with history section"
      exports: ["ChatSidebar"]
    - path: "src/components/chat/ConsultationList.tsx"
      provides: "List of past consultations"
      exports: ["ConsultationList"]
    - path: "src/app/chat/layout.tsx"
      provides: "Layout wrapper with SidebarProvider"
      contains: "SidebarProvider"
  key_links:
    - from: "src/app/chat/layout.tsx"
      to: "src/components/chat/ChatSidebar.tsx"
      via: "imports and renders ChatSidebar"
      pattern: "<ChatSidebar"
    - from: "src/components/chat/ChatSidebar.tsx"
      to: "src/components/chat/ConsultationList.tsx"
      via: "renders consultation list"
      pattern: "<ConsultationList"
---

<objective>
Set up the sidebar UI scaffolding for chat history display.

Purpose: Create the visual structure for viewing past consultations. This runs parallel to Plan 01 (data layer) - UI is ready before data is wired.

Output: Collapsible sidebar with placeholder consultation list, integrated into chat page layout.
</objective>

<execution_context>
@/Users/mad/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mad/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-consultation-saving/08-CONTEXT.md
@.planning/phases/08-consultation-saving/08-RESEARCH.md

@src/app/chat/page.tsx
@src/components/chat/ChatInterface.tsx
@src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn sidebar components</name>
  <files>src/components/ui/sidebar.tsx, src/components/ui/sheet.tsx, src/components/ui/tooltip.tsx</files>
  <action>
Run shadcn CLI to add sidebar and its dependencies:

```bash
npx shadcn@latest add sidebar sheet tooltip --yes
```

This will create:
- src/components/ui/sidebar.tsx (main sidebar primitives)
- src/components/ui/sheet.tsx (for mobile overlay)
- src/components/ui/tooltip.tsx (for sidebar tooltips when collapsed)

Also install the collapsible dependency if not already present:
```bash
npm install @radix-ui/react-collapsible
```

Verify all files are created and exports work.
  </action>
  <verify>Files exist and `npm run build` passes</verify>
  <done>shadcn sidebar, sheet, tooltip components installed</done>
</task>

<task type="auto">
  <name>Task 2: Create ChatSidebar and ConsultationList components</name>
  <files>src/components/chat/ChatSidebar.tsx, src/components/chat/ConsultationList.tsx</files>
  <action>
1. Create ConsultationList.tsx:
```typescript
// Placeholder list - will be connected to Firestore in Plan 03
interface ConsultationListProps {
  onSelect: (id: string) => void;
  selectedId?: string | null;
}

// For now, show empty state or loading skeleton
// Will receive consultations prop after Plan 01 data layer is wired
```

Display:
- Empty state: "Nera issaugotu konsultaciju" with icon
- Each item shows: title (or "Nauja konsultacija"), relative date (e.g., "vakar", "pries 2 val.")
- Selected state styling (bg-muted)
- Hover state
- Topic badge (small, muted)

2. Create ChatSidebar.tsx using shadcn Sidebar components:

Structure:
```
Sidebar (collapsible="icon", side="left")
  SidebarHeader
    - Logo/brand (optional, keep minimal)
    - "Nauja konsultacija" button (primary action)
  SidebarContent
    SidebarGroup
      SidebarGroupLabel: "Istorija"
      SidebarGroupContent
        ConsultationList
  SidebarFooter
    - Settings toggle for "Saugoti pagal numatyma" (placeholder, wired in Plan 05)
  SidebarRail (for resize handle)
```

Use Lucide icons: MessageSquare for consultations, Plus for new, Settings for toggle.

Mobile behavior: sidebar auto-converts to Sheet via shadcn's built-in isMobile hook.
  </action>
  <verify>`npm run build` passes, components render without errors</verify>
  <done>ChatSidebar.tsx and ConsultationList.tsx created with proper structure</done>
</task>

<task type="auto">
  <name>Task 3: Create chat layout with SidebarProvider</name>
  <files>src/app/chat/layout.tsx</files>
  <action>
Create a new layout file for /chat that wraps the page with SidebarProvider.

```typescript
// src/app/chat/layout.tsx
import { cookies } from 'next/headers';
import { SidebarProvider, SidebarInset } from '@/components/ui/sidebar';
import { ChatSidebar } from '@/components/chat/ChatSidebar';

export default async function ChatLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  // Read sidebar state from cookie (shadcn pattern)
  const cookieStore = await cookies();
  const defaultOpen = cookieStore.get('sidebar:state')?.value === 'true';

  return (
    <SidebarProvider defaultOpen={defaultOpen}>
      <ChatSidebar />
      <SidebarInset>{children}</SidebarInset>
    </SidebarProvider>
  );
}
```

Note: This is a server component that reads cookies. The ChatSidebar is a client component.

The existing page.tsx content remains unchanged - it just renders inside SidebarInset now.

Add SidebarTrigger button to the Header or context bar in page.tsx for mobile toggle (hamburger icon).
  </action>
  <verify>Visit /chat - sidebar appears on left, main content on right. Toggle works.</verify>
  <done>Chat layout created with SidebarProvider wrapping page content</done>
</task>

</tasks>

<verification>
- `npm run build` passes
- /chat page shows sidebar on left
- Sidebar collapses/expands with Cmd+B (or toggle button)
- On mobile viewport, sidebar shows as sheet overlay
- Empty state displays when no consultations
</verification>

<success_criteria>
- shadcn sidebar components installed
- ChatSidebar renders with header, content (empty list), footer
- ConsultationList shows empty state
- Chat layout wraps page with SidebarProvider
- Keyboard shortcut Cmd+B toggles sidebar
</success_criteria>

<output>
After completion, create `.planning/phases/08-consultation-saving/08-02-SUMMARY.md`
</output>
